<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AI Cyber Security Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
  </head>
  <body>
    {% include 'header.html' %}

    <div class="container mt-4">
      <div class="row">
        <div class="col-md-8">
          <h1>Dashboard</h1>
          <p class="lead">Unified ML detection platform</p>
        </div>
        <div class="col-md-4 text-end">
          <p>System status: <span class="badge bg-success">OK</span></p>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-md-3">
          <div class="card p-3">
            <h5>Total Predictions</h5>
            <p class="display-6">{{ stats.total if stats else 0 }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-3">
            <h5>URLs Checked</h5>
            <p class="display-6">{{ stats.url_checked if stats else 0 }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-3">
            <h5>Spam Detected</h5>
            <p class="display-6">{{ stats.spam_detected if stats else 0 }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-3">
            <h5>QR Quishing</h5>
            <p><strong>Scanned:</strong> {{ qr_stats.qr_scans if qr_stats else 0 }}</p>
            <p><strong>Detected:</strong> {{ qr_stats.quishing_detected if qr_stats else 0 }}</p>
            <p><strong>Redirect Traversals:</strong> {{ qr_stats.redirect_traversals if qr_stats else 0 }}</p>
          </div>
        </div>
      </div>

      <!-- Modules grid: visually match dashboard cards shown in screenshot -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="modules">
            <div class="module">
              <div class="m-icon">üîó</div>
              <h4>Phishing URL Detection</h4>
              <p>Analyze URL lexical and structural features to detect spoofed links.</p>
              <a class="btn" href="/phishing-url">Analyze Now</a>
            </div>

            <div class="module">
              <div class="m-icon">üõ°Ô∏è</div>
              <h4>Website Feature-Based Detection</h4>
              <p>Feature extraction from website content and WHOIS for model analysis.</p>
              <a class="btn" href="/phishing-website">Analyze Now</a>
            </div>

            <div class="module">
              <div class="m-icon">üñºÔ∏è</div>
              <h4>Webpage Screenshot Detection</h4>
              <p>OCR + rule-based analysis to find phishing cues in screenshots.</p>
              <a class="btn" href="/webpage-phishing">Analyze Now</a>
            </div>

            <div class="module">
              <div class="m-icon">‚úâÔ∏è</div>
              <h4>Spam Message Detection</h4>
              <p>Classify messages using heuristics or a trained spam model.</p>
              <a class="btn" href="/spam">Analyze Now</a>
            </div>

            <div class="module">
              <div class="m-icon">ÔøΩ QR</div>
              <h4>QR Quishing Detection</h4>
              <p>Detects phishing QR codes by decoding embedded URLs and analyzing redirection traversal behavior.</p>
              <a class="btn" href="/qr-quishing">Analyze Now</a>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-12">
          <h5>Last Prediction</h5>
          {% if last %}
            <div class="card p-3">
              <p><strong>Service:</strong> {{ last.service }}</p>
              <p><strong>Input:</strong> {{ last.input }}</p>
              {# Show concise result: "Phishing" or "Not Phishing" based on stored result string #}
              {% set _res = (last.result|string) if last.result is defined else '' %}
              {% if 'phish' in _res|lower %}
                <p><strong>Result:</strong> Phishing</p>
              {% else %}
                <p><strong>Result:</strong> Not Phishing</p>
              {% endif %}
              <p><strong>When:</strong> {{ last.created_at }}</p>
            </div>
          {% else %}
            <p>No predictions yet.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
